import{usePageLang as z}from"@vuepress/client";import b from"artplayer";import{ref as v,computed as N,unref as g,onMounted as S,isRef as k,watch as A,defineComponent as L,onBeforeUnmount as R,h as x,camelize as P}from"vue";import{isString as T}from"@vuepress/shared";import{useEventListener as E}from"@vueuse/core";const M=e=>T(e)?e:`${e}px`,O=(e,t=0)=>{const r=v(),o=N(()=>M(g(e.width)||"100%")),a=v("auto"),c=s=>{if(T(s)){const[p,y]=s.split(":"),n=Number(p)/Number(y);if(!Number.isNaN(n))return n}return typeof s=="number"?s:16/9},l=s=>{const p=g(e.height),y=c(g(e.ratio));return p?M(p):`${Number(s)/y+g(t)}px`},u=()=>{r.value&&(a.value=l(r.value.clientWidth))};return S(()=>{u(),k(t)&&A(t,()=>u()),E("orientationchange",()=>u()),E("resize",()=>u())}),{el:r,width:o,height:a}},D=["mp4","mp3","webm","ogg","m3u8","hls","ts","flv","mpd","dash"],U=e=>(e==null?void 0:e.split(".").pop())||"",_=async(e,t,r,o=!1,a=0)=>{const c=(await import("dashjs/dist/dash.all.min.js")).default;if(c.supportsMediaSource()){const l=c.MediaPlayer().create();l.initialize(e,t,o,a),r(()=>l.destroy())}},C=async(e,t,r)=>{const o=(await import("mpegts.js/dist/mpegts.js")).default;if(o.isSupported()){const a=o.createPlayer({type:"flv",url:t});a.attachMediaElement(e),a.load(),r(()=>a.destroy())}},H=async(e,t,r)=>{const o=(await import("hls.js/dist/hls.min.js")).default;if(e.canPlayType("application/x-mpegURL")||e.canPlayType("application/vnd.apple.mpegURL"))e.src=t;else if(o.isSupported()){const a=new o;a.attachMedia(e),a.on(o.Events.MEDIA_ATTACHED,function(){a.loadSource(t)}),r(()=>a.destroy())}},I=["no-fullscreen","no-hotkey","no-playback-rate","no-setting","no-mutex","no-plays-inline"],$=["airplay","autoplay","aspect-ratio","auto-mini","auto-size","auto-orientation","auto-playback","fast-forward","flip","fullscreen-web","lock","loop","is-live","muted","mini-progress-bar","pip","screenshot","subtitle-offset"],j=["en","pl","cs","es","fa"],B=["zh-cn","zh-tw"],F=e=>{const t=e.toLowerCase(),r=e.split("-")[0];return j.includes(r)?r:B.includes(t)?t:t==="zh"?"zh-cn":"en"};var Y=L({name:"ArtPlayer",props:{src:{type:String,required:!0},type:{type:String,default:""},poster:{type:String,default:""},title:{type:String,default:""},width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:void 0},ratio:{type:[String,Number],default:16/9},config:{type:Object,default:null},customPlayer:{type:Function,default:e=>e}},setup(e,{attrs:t}){const r=z(),{el:o,width:a,height:c}=O(e,0);let l;const u=()=>{var s,p,y;const n={theme:"#3eaf7c",...ART_PLAYER_OPTIONS,container:o.value,title:e.title,poster:e.poster,url:e.src,type:e.type||U(e.src),lang:F(r.value),...e.config,useSSR:!0},w=Object.keys(t);if(I.forEach(i=>{w.includes(i)&&(n[P(i.replace(/^no-/,""))]=!1)}),$.forEach(i=>{w.includes(i)&&(n[P(i)]=!0)}),n.type){const i=n.customType??(n.customType={});if(D.includes(n.type.toLowerCase()))switch(n.type){case"m3u8":case"hls":i[s=n.type]??(i[s]=(d,f,m)=>H(d,f,h=>{m.on("destroy",h)}));break;case"flv":i[p=n.type]??(i[p]=(d,f,m)=>C(d,f,h=>{m.on("destroy",h)}));break;case"mpd":case"dash":i[y=n.type]??(i[y]=(d,f,m)=>_(d,f,h=>{m.on("destroy",h)}));break}else console.warn(`[components]: ArtPlayer does not support current file type ${n.type}!`)}return n};return S(async()=>{const s=new b(u());l=await e.customPlayer(s)||s}),R(()=>{l==null||l.destroy()}),()=>x("div",{ref:o,style:{width:a.value,height:c.value},innerHTML:b.html})}});export{Y as default};
//# sourceMappingURL=ArtPlayer.js.map
